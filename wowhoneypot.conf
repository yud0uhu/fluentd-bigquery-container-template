<source>
  @type tail
  format /^\[(?<time>[^\]]*)\] (?<clientip>[^ ]*) (?<hostname>[^ ]*) "(?<method>\S+)(?: +(?<path>[^ ]*) +\S*)?" (?<status>[^ ]*) (?<mrrid>[^ ]*) (?<requestbody>[^]*)$/
  <parse>
    @type none
  </parse>
  path /var/log/wowhoneypod/access_log
  pos_file /var/log/td-agent/os.wowhoneypot-access.pos
  read_from_head true
  fetch_schema  true
  tag os.wowhoneypot-access
</source>

<match os.wowhoneypot-access>
  @type bigquery_insert
  # Authenticate with BigQuery using the VM's service account.
  auth_method compute_engine
  project wowhoneypot-log-stack
  dataset wowhoneypot-log-stack.log
  table wowhoneypot
  fetch_schema true
  <inject>
    # Convert fluentd timestamp into TIMESTAMP string
    time_key time
    time_type string
    time_format %Y-%m-%d %H:%M:%S%z
  </inject>
</match>

